<%= render 'shared/side-bar' %>

<div class="drill-main">
  <div class="show-drill">
    <div class="show-drill-title_box">
      <div class="show-drill-title"><%= @drill.title %></div>
    </div>

    <div class="show-drill-sub_1">
      <div class="show-drill-genre">ジャンル：<%= link_to @drill.genre.name, '#' %></div>
      <div class="show-drill-user"><%= link_to "#{@drill.user.nickname}さん", '#', class: "show-drill-user_name" %>が投稿</div>
    </div>

    <div class="show-drill-sub_2">
      <div><%= "#{@drill.quizzes.count}問のクイズ" %></div>
      <div>000いいね</div>
      <div><%= link_to "ランキングへ", '#' %></div>
    </div>

    <div class="show-drill-ans_times">
      <% if user_signed_in? && @drill.user_id == current_user.id %>
        あなたが作成したクイズ集です
      <% elsif user_signed_in? && @results.present? %>
        <%= "あなたは#{@results.count}回挑戦しました" %>
      <% elsif user_signed_in? %>
        あなたはまだ挑戦していません
      <% else %>
        ログインすると挑戦回数が表示されます
      <% end %>
    </div>

    <div class="show-drill-info_box">
      <div class="show-drill-info"><%= "詳細：#{@drill.information}" %></div>
    </div>
    <div class="show-drill-btn">
      <% if user_signed_in? && current_user.id == @drill.user_id %>
        <div class="drill-editor">
          <div><%= link_to "編集する", edit_drill_path(@drill), class: "to_edit" %></div>
          <div><%= link_to "削除する", drill_path(@drill), method: :delete, data: {confirm: "本当に削除しますか？\n※このクイズ集に関するクイズや回答した人の成績が全て削除されます。"}, class: "to_destroy" %></div>
        </div>

      <% elsif user_signed_in? %>
        <div><%= link_to 'クイズに挑戦', drill_quizzes_path(@drill), class: "challenge-btn" %></div>

      <% else %>
        <div>※クイズに挑戦するにはログインする必要があります</div>
      <% end %>
    </div>
  </div>

  <% if user_signed_in? && current_user.id == @drill.user_id %>
    <%= render 'shared/quiz' %>
    <%= render 'shared/quiz-form' %>
  
  <% elsif @results.present? %>
  <div class="show-drill-results-box">
    <div class="show-drill-results-title">〜過去の成績〜</div>
    <div class="show-drill-results">
      <% @results.each do |result| %>
        <div>
          <%= result.times %>回目は、<%= result.number_of_questions %>問中<%= result.number_of_correct_answers %>問正解で、<%= result.correct_answer_rate.round(1) %>%の正解率でした。
        </div>
      <% end %>
    </div>
  </div>
  <% end %>
</div>